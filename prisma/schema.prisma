// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String?
  role      Role      @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]
}

enum Role {
  USER
  ADMIN
}

model Project {
  id            String     @id @default(cuid())
  name          String
  description   String?
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  // Score tier configuration
  tierLowMax    Int        @default(40)   // 0-40% = low tier
  tierMediumMax Int        @default(70)   // 41-70% = medium tier (71-100% = high)
  tierLowLabel  String     @default("Needs Improvement")
  tierMediumLabel String   @default("Good")
  tierHighLabel String     @default("Excellent")
  tierLowMsg    String?    // Custom message for low scorers
  tierMediumMsg String?    // Custom message for medium scorers  
  tierHighMsg   String?    // Custom message for high scorers
  stats         Stat[]
  forms         Form[]
}

model Stat {
  id          String     @id @default(cuid())
  name        String
  description String?
  minValue    Int        @default(1)
  maxValue    Int        @default(10)
  category    String?    // Category grouping: gameplay, visuals, audio, balance, progression, multiplayer, overall
  weight      Float      @default(1.0)  // Weight multiplier for category scoring
  projectId   String
  project     Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  questions   Question[]
}

model Form {
  id                 String     @id @default(cuid())
  title              String
  description        String?
  isActive           Boolean    @default(false)
  // Landing page fields
  landingTitle       String?    // Main headline for landing page
  landingSubtitle    String?    // Supporting text
  landingDescription String?    // Detailed description
  landingImage       String?    // Cover image URL
  ctaText            String     @default("Start Quiz")  // Call-to-action button text
  themeColor         String     @default("#8b5cf6")     // Primary theme color (purple default)
  // Results display settings
  showCategoryScores Boolean    @default(true)   // Show category breakdown on results
  showOverallScore   Boolean    @default(true)   // Show overall score on results
  showComparison     Boolean    @default(false)  // Show "your score vs average"
  projectId          String
  project            Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  questions          Question[]
  responses          Response[]
}

model Question {
  id           String       @id @default(cuid())
  formId       String
  form         Form         @relation(fields: [formId], references: [id], onDelete: Cascade)
  statId       String?      // Optional - some question types may not have a direct stat
  stat         Stat?        @relation(fields: [statId], references: [id], onDelete: Cascade)
  questionText String       // The actual question text
  type         QuestionType @default(SLIDER)
  options      Json?        // For multiple choice: [{text: "Option A", points: 10, statId?: "..."}, ...]
  minValue     Int          @default(1)   // For slider type
  maxValue     Int          @default(10)  // For slider type
  order        Int          @default(0)
  createdAt    DateTime     @default(now())
  answers      Answer[]
}

enum QuestionType {
  SLIDER          // Rate on a scale (1-10)
  YES_NO          // Yes/No/Maybe
  MULTIPLE_SINGLE // Multiple choice, pick one
  MULTIPLE_MULTI  // Multiple choice, pick many
  TEXT_RATING     // Open text + rate the stat
}

model Response {
  id         String   @id @default(cuid())
  formId     String
  form       Form     @relation(fields: [formId], references: [id], onDelete: Cascade)
  comment    String?
  respondent String?
  createdAt  DateTime @default(now())
  answers    Answer[]
}

model Answer {
  id          String   @id @default(cuid())
  responseId  String
  response    Response @relation(fields: [responseId], references: [id], onDelete: Cascade)
  questionId  String
  question    Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  value       Int?     // Numeric value (for slider, yes/no points, selected option points)
  textValue   String?  // Text value (for open text questions)
  selectedIds Json?    // For multi-select: array of selected option indices
  createdAt   DateTime @default(now())
}
